<%= form_for attachment, url: [:admin, typecast_for_attachable_routing(attachable), attachment.becomes(Attachment)], as: :attachment do |form| %>
  <%= form.errors %>

  <%= form.text_field :title %>

  <% if attachable.allows_attachment_references? %>
    <%= render 'reference_fields', edition: attachable, form: form %>
  <% end %>

  <% case attachment %>
  <% when FileAttachment %>
    <%= render 'attachment_data_fields', form: form %>
  <% when HtmlAttachment %>
    <%= form.check_box :manually_numbered_headings %>
    <%= form.text_area :body %>
  <% end %>

  <%= hidden_field_tag :html, params[:html] %>

  <%= form.save_or_cancel cancel: attachable_attachments_path(attachable) %>
<% end %>
