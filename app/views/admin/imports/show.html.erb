<% page_title "Import of #{@import.original_filename}" %>

<%= content_tag_for :div, @import do %>
  <h1>Import of <%= @import.original_filename %></h1>
  <p>Created: <%= render_datetime_microformat(@import, :created_at) { @import.created_at.to_s(:long)} %></p>
  <p>Imported by <%= linked_author @import.creator %></p>

  <% if @import.status == :queued %>
    <p class="summary">Import queued</p>
  <% elsif @import.status == :running %>
    <p class="summary">Import running (row <%= @import.current_row %> / <%= @import.total_rows %></p>
  <% elsif @import.status == :failed %>
    <p class="summary">Import failed with <%= pluralize(@import.import_errors.count, "error") %></p>

    <table id="errors">
      <thead>
        <tr>
          <th>Row Number</th>
          <th>Message</th>
        </tr>
      </thead>
      <tbody>
        <% @import.import_errors.each do |import_error| %>
          <tr class="import_error">
            <td class="row_number"><%= import_error[:row_number] %></td>
            <td class="message"><pre><%= import_error[:message] %></pre></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <h2>Log</h2>
    <p class="log"><pre><%= @import.log %></pre></p>

  <% else %>
    <p class="summary">Imported successfully</p>

    <h2 id="success">Documents added</h2>
    <% if @import.document_sources.any? %>
      <ul class="added">
        <% @import.document_sources.each do |document_source| %>
          <li><%= link_to document_source.document.latest_edition.title, admin_edition_path(document_source.document.latest_edition) %> imported from <%= link_to document_source.url, document_source.url %></li>
        <% end %>
      </ul>
    <% else %>
      <p class="added">None</p>
    <% end %>

    <h2 id="already_imported">Already imported</h2>
    <% if @import.already_imported.any? %>
      <ul class="already_imported">
        <% @import.already_imported.each do |already_imported| %>
          <% document_source = DocumentSource.find_by_url(already_imported[:url]) %>
          <% edition = document_source.document.latest_edition %>
          <li><%= link_to edition.title, admin_edition_path(edition) %> imported from <%= link_to document_source.url, document_source.url %></li>
        <% end %>
      </ul>
    <% else %>
      <p class="already_imported">None</p>
    <% end %>

    <h2 id="log">Log</h2>
    <p class="log"><pre><%= @import.log %></pre></p>



  <% end %>
<% end %>