(function() {
  "use strict";
  window.GOVUK = window.GOVUK || {}

  var enhanceUnpublishingForm = {
    init: function(params) {
      this.$form = $(params.selector);
      this.$submit_button = $('input[type="submit"]', this.$form);
      this.$explanation = $('.js_explanation');
      this.$alt_url = $('.js_alt_url');
      this.$redirect = $('.js_redirect');
      this.$auto_redirect = $('.auto_redirect');

      this.refreshFormFields();
      this.hideExplanationIfRedirecting();

      $("input[name='unpublishing[unpublishing_reason_id]']", this.$form).change(this.refreshFormFields);
      this.$redirect.find('input[type="checkbox"]').change(this.hideExplanationIfRedirecting);
    },

    refreshFormFields: function() {
      var selectedReason =  $("input[name='unpublishing[unpublishing_reason_id]']:checked").val();

      switch(selectedReason) {
        case '<%= UnpublishingReason::Archived.id %>':
          enhanceUnpublishingForm.$explanation.show();
          enhanceUnpublishingForm.$alt_url.hide().find('input').val('');
          enhanceUnpublishingForm.$redirect.hide().find('input').prop('checked', false);
          enhanceUnpublishingForm.$auto_redirect.hide().find('input').val('');
          enhanceUnpublishingForm.$submit_button.val('Archive');
          break;
        case '<%= UnpublishingReason::PublishedInError.id %>':
          enhanceUnpublishingForm.$explanation.show();
          enhanceUnpublishingForm.$alt_url.show();
          enhanceUnpublishingForm.$redirect.show();
          enhanceUnpublishingForm.$auto_redirect.hide().find('input').prop('checked', false);
          enhanceUnpublishingForm.$submit_button.val('Unpublish');
          break;
        case '<%= UnpublishingReason::Consolidated.id %>':
          enhanceUnpublishingForm.$explanation.hide().find('textarea').val('');
          enhanceUnpublishingForm.$alt_url.show();
          enhanceUnpublishingForm.$redirect.hide().find('input').prop('checked', false);
          enhanceUnpublishingForm.$auto_redirect.show();
          enhanceUnpublishingForm.$submit_button.val('Unpublish');
          break;
      }
    },

    hideExplanationIfRedirecting: function() {
      if( enhanceUnpublishingForm.$redirect.find('input[type="checkbox"]').prop('checked') ) {
        enhanceUnpublishingForm.$explanation.hide().find('textarea').val('');
      } else {
        enhanceUnpublishingForm.$explanation.show();
      }
    }
  };

  window.GOVUK.enhanceUnpublishingForm = enhanceUnpublishingForm;
}());
